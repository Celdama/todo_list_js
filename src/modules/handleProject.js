import { v4 as uuidv4 } from 'uuid';
import { handleTodoListModule } from './handleTodo';

const projectFactory = (title, defaultProject) => {
  const todosListInThisProject = [];

  return {
    id: uuidv4(),
    title: title.toLowerCase(),
    todos: todosListInThisProject,
    defaultProject: defaultProject || false,
  };
};

const handleProjectListModule = (() => {
  let projectList = [];

  const addProject = (project) => {
    projectList.push(project);
  };

  const getProjectByName = (name) => {
    const results = projectList.find(
      (project) => project.title === name.toLowerCase(),
    );
    return results;
  };

  const addTodoToProject = (name, todo) => {
    const projectToAdd = getProjectByName(name);

    if (projectToAdd.todos.find((task) => task.id === todo.id)) return;
    if (todo.project !== name) return;
    projectToAdd.todos.push(todo);
  };

  // A supprimer une fois le dev terminÃ©
  const getAllProject = () => {
    console.table(projectList);
    return projectList;
  };

  const getAllProjectExceptDefaultProject = () => {
    // default project = inbox, today, upcomming
    const allProjectExceptDefault = projectList.filter(
      (project) => !project.defaultProject,
    );

    return allProjectExceptDefault;
  };

  const getAllProjectExceptTodayAndUpcomming = () => {
    const allProjectExceptTodayAndUpcomming = projectList.filter(
      (project) => project.title !== 'today' && project.title !== 'upcoming',
    );

    return allProjectExceptTodayAndUpcomming;
  };

  const getTodoByProjectName = (name) => {
    const results = projectList.find(
      (project) => project.title === name.toLowerCase(),
    );
    return results.todos;
  };

  const deleteTodoInThisProject = (project, todoId) => {
    const todosParentProject = getProjectByName(project);
    todosParentProject.todos = todosParentProject.todos.filter(
      (item) => item.id !== todoId,
    );
  };

  const deleteProject = (id, projectTitle) => {
    projectList = projectList.filter((item) => item.id !== id);

    handleTodoListModule.deleteAllTodoFromDeletedProject(projectTitle);
  };

  return {
    addProject,
    getProjectByName,
    addTodoToProject,
    getAllProject,
    getAllProjectExceptDefaultProject,
    getTodoByProjectName,
    deleteTodoInThisProject,
    deleteProject,
    getAllProjectExceptTodayAndUpcomming,
  };
})();

export { projectFactory, handleProjectListModule };
